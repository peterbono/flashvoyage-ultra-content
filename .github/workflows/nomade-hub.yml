name: ğŸ  Nomade Hub Asie - Publication Automatique

on:
  schedule:
    # ExÃ©cuter tous les jours Ã  6h00 UTC (8h00 heure franÃ§aise)
    - cron: '0 6 * * *'
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Mode test (simulation)'
        required: false
        default: 'false'
        type: boolean

jobs:
  nomade-hub:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout du code
      uses: actions/checkout@v4
      
    - name: ğŸ“¦ Configuration Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ§¹ Nettoyage du cache npm
      run: npm cache clean --force
      
    - name: ğŸ“š Installation des dÃ©pendances
      run: |
        npm install
        echo "âœ… DÃ©pendances installÃ©es"
        
    - name: ğŸ”§ Configuration des variables d'environnement
      run: |
        echo "WORDPRESS_URL=${{ secrets.WORDPRESS_URL }}" >> .env
        echo "WORDPRESS_USERNAME=${{ secrets.WORDPRESS_USERNAME }}" >> .env
        echo "WORDPRESS_APP_PASSWORD=${{ secrets.WORDPRESS_APP_PASSWORD }}" >> .env
        echo "PEXELS_API_KEY=${{ secrets.PEXELS_API_KEY }}" >> .env
        echo "OPENAI_API_KEY=${{ secrets.OPENAI_API_KEY }}" >> .env
        echo "âœ… Variables d'environnement configurÃ©es"
        
    - name: ğŸ§ª Test du systÃ¨me nomade
      run: |
        echo "ğŸ§ª Test du systÃ¨me nomade..."
        node test-nomade-system.js
        echo "âœ… Tests terminÃ©s"
        
    - name: ğŸ  GÃ©nÃ©ration du hub nomade
      if: ${{ !inputs.test_mode }}
      run: |
        echo "ğŸ  GÃ©nÃ©ration du hub nomade..."
        node nomade-hub-main.js
        echo "âœ… Hub nomade gÃ©nÃ©rÃ©"
        
    - name: ğŸ§ª Test du hub nomade (mode simulation)
      if: ${{ inputs.test_mode }}
      run: |
        echo "ğŸ§ª Test du hub nomade en mode simulation..."
        node nomade-hub-main.js
        echo "âœ… Test terminÃ©"
        
    - name: ğŸ“Š Rapport de gÃ©nÃ©ration
      if: always()
      run: |
        echo "ğŸ“Š RAPPORT DE GÃ‰NÃ‰RATION DU HUB NOMADE"
        echo "======================================"
        echo "Date: $(date)"
        echo "Mode: ${{ inputs.test_mode && 'Test' || 'Production' }}"
        echo "Status: ${{ job.status }}"
        echo "======================================"
